- name: Install Docker
  ansible.builtin.shell: cd ~ && curl -fsSL https://get.docker.com -o get-docker.sh && sudo sh get-docker.sh

- name: "create build directory"
  file:
    path: /home/mkljestan/ansible
    state: directory
    owner: mkljestan
    group: mkljestan
    mode: '0755'

- name: "copy ansible directory"
  copy:
    src: ../files/
    dest: /home/mkljestan/ansible

- name: "gcloud docker authentication"
  ansible.builtin.shell: yes | gcloud auth configure-docker europe-central2-docker.pkg.dev
      
- name: build docker image
  docker_image:
    name: europe-central2-docker.pkg.dev/terraform-ansible-389111/docker-images/server-app
    tag: 1.0.0
    build:
      path: /home/mkljestan/ansible
    source: build
    push: yes